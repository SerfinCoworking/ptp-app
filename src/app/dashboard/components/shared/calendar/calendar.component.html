<div class="calendar-header-box mb-2" [class.expanded-calendar]="isShow">

  <h2 class="m-0">{{ calendar.schedule.objective.name }} </h2>
  <div class="d-flex period-title align-items-center" [ngClass]="{'justify-content-end': !calendar.period.docs.length, 'justify-content-between': calendar.period.docs.length}">

    <h2 class="m-0" *ngIf="isShow && calendar.period.docs.length">
      Período: {{ calendar.period.docs[0].fromDate | date:'MMMM yyyy'}} / {{ calendar.period.docs[0].toDate | date:"MMMM yyyy" }}
    </h2>
    <div class="d-flex justify-content-end">
      <div class="d-flex align-items-center justify-content-center mr-2">
        <button mat-stroked-button class="btn btn-sm btn-primary text-white mr-2" (click)="previousPeriod()" *ngIf="isShow" [disabled]="disablePrevPeriod">
          <fa-icon [icon]="faAngleLeft" *ngIf="!loadingLeft"></fa-icon>
          <fa-icon [icon]="faSpinner" [spin]="true" size="1x" *ngIf="loadingLeft"></fa-icon>
        </button>
        <div class="mr-2">período {{ calendar.period.page }} de {{calendar.period.pages}}</div>
        <button mat-stroked-button class="btn btn-sm btn-primary text-white" (click)="nextPeriod()" *ngIf="isShow" [disabled]="disableNextPeriod">
          <fa-icon [icon]="faAngleRight" *ngIf="!loadingRight"></fa-icon>
          <fa-icon [icon]="faSpinner" [spin]="true" size="1x" *ngIf="loadingRight"></fa-icon>
        </button>
      </div>
      <a mat-stroked-button class="btn btn-warning btn-sm mr-2" [routerLink]="['/dashboard/agendas/editar', calendar.period.docs[0]._id]" routerLinkActive="active" *appCan="['schedule', 'edit']">
        <fa-icon [icon]="faPen"></fa-icon>
      </a>
      <button mat-stroked-button class="btn btn-light btn-sm" (click)="exitFullScreen($event)" *ngIf="isShow">
        <fa-icon [icon]="faTimesCircle"></fa-icon>
      </button>
    </div>
  </div>
</div>
<div class="position-relative cal-main-cont">
  <ng-container *ngIf="calendar.period.docs.length">
    <div class="calendar-container h-100">
      <!-- header -->
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Domingo" | slice:0:3) : "Domingo"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Lunes" | slice:0:3) : "Lunes"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Martes" | slice:0:3) : "Martes"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Miércoles" | slice:0:3) : "Miércoles"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Jueves" | slice:0:3) : "Jueves"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Viernes" | slice:0:3) : "Viernes"}}
      </div>
      <div class="calendar-header d-flex align-items-center justify-content-center">
        {{!isShow ? ("Sábado" | slice:0:3) : "Sábado"}}
      </div>

      <ng-container *ngFor="let day of calendar.days; let count = index">
        <app-day
          (click)="expandedDate = ((expandedDate === day && isShow) || !eventsByDay[count].length) ? null : day"
          [day]="day"
          [events]="eventsByDay[count]"
          [minDate]="minDate"
          [maxDate]="maxDate"
          [today]="today"
          [collapseEvents]="collapseEvents"></app-day>

        <app-day-event
          [shifts]="eventsByDay[count]"
          [day]="day"
          [dayIndex]="(count + 1)"
          [dayEventClass]="day == expandedDate ? 'expanded' : 'collapsed'"></app-day-event>
      </ng-container>
    </div>
  </ng-container>
  <ng-container *ngIf="!calendar.period.docs.length">
    <div class="w-100 h-100 pt-4 text-center">
      No tiene periodos asignados!
    </div>
  </ng-container>
  <div class="cal-actions align-items-center justify-content-center d-flex" *ngIf="!isShow">

    <a mat-stroked-button class="btn btn-success btn-sm m-1" [routerLink]="['/dashboard/agendas/crear']" [queryParams]="{scheduleId: calendar.schedule._id}" routerLinkActive="active" *appCan="['schedule', 'create']">
      <fa-icon [icon]="faPlus"></fa-icon>
    </a>

    <ng-container *ngIf="calendar.period.docs.length">
      <button mat-stroked-button class="btn btn-light btn-sm m-1" (click)="showCalendarEmitter()">
        <fa-icon [icon]="faEye"></fa-icon>
      </button>
      
      <a mat-stroked-button class="btn btn-warning btn-sm m-1" [routerLink]="['/dashboard/agendas/editar', calendar.period.docs[0]._id]" routerLinkActive="active" *appCan="['schedule', 'edit']">
        <fa-icon [icon]="faPen"></fa-icon>
      </a>
      
      <button mat-stroked-button class="btn btn-danger btn-sm m-1" (click)="openDialog(calendar.period.docs[0])">
        <fa-icon [icon]="faTrashAlt"></fa-icon>
      </button>
    </ng-container>
  </div>
</div>
